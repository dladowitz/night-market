-#TODO MAJOR - clean up all this presentation logic. No really sure how.
-#Helpers and Decorators shouldn't have a bunch of html in them. So how should this be handled?
-#TODO add ability to change category field

%h1.mb30
  = @meal.category
  for
  = link_to @event.name, event_path(@event)

  = link_to "Dishes", event_meal_dishes_path(@event, @meal), class: "btn btn-info"
  = link_to "Meals", event_meals_path(@event), class: "btn btn-primary"
  = link_to "Delete", event_meal_path(@event, @meal), method: :delete, class: "btn btn-danger", data: { confirm: "Are you, like, for sure?" }

.row#status
  .col-sm-12
    .col-sm-8#status
      .widget-box.transparent
        .widget-header
          .widget-title
            %span.fsize-20
              %i.fa.fa-bar-chart
            %span.fsize-25
              Status
        .widget-body
          .widget-main
            %table.table.table-hover
              %thead
                %tr
                  %th.no-lines Type
                  %th.no-lines Servings
                  %th.no-lines Transport Method
                  %th.no-lines Order Status
              %tbody
                - @meal.dishes.decorate.each do |dish|
                  %tr
                    %td.no-lines= dish.category

                    %td.no-lines{ class: ("text-danger" if dish.show_warning?(:servings)) }
                      %span= dish.servings
                      - if dish.show_warning?(:servings)
                        %span.fa.fa-warning{ title: "Servings don't equal guest count", data: {toggle: "tooltip"}}

                    %td.no-lines{ class: ("text-danger" if dish.show_warning?(:transport))}
                      = dish.transport_method
                      - if dish.show_warning?(:transport)
                        %span.text-danger.fa.fa-warning{ title: "Delivery time is not set", data: {toggle: "tooltip"}}

                    %td.no-lines{class: ("text-danger" if dish.show_warning?(:order))}
                      = dish.order_status
                      - if dish.show_warning?(:order)
                        %span.fa.fa-warning{ title: "Dish requires pre-ordering", data: {toggle: "tooltip"}}

    .col-sm-4#missing-options
      .widget-box.mb20.transparent
        .widget-header
          .widget-title
            %span.fsize-20
              %i.fa.fa-bar-chart
            %span.fsize-25
              Options
        .widget-body
          .widget-main
            %table.table
              %thead
                %tr
                  %th Missing Options
                  %th Ignore
              %tbody
                - @meal.missing_options.each do |option|
                  %tr.text-danger
                    %td
                      %span= option
                      %span.fa.fa-warning{ title: "What are the #{option} folks gonna eat?", data: {toggle: "tooltip"}}
                    %td No

.row#details
  .col-sm-9
    .widget-box.transparent
      .widget-header
        .widget-title
          %span.fsize-20
            %i.fa.fa-search
          %span.fsize-25
            Details
      .widget-body
        .widget-main
          = form_for [@event, @meal], html: {class: "form-horizontal", role: "form"} do |f|
            .form-group
              = f.label :date, class: "control-label col-sm-2"
              .col-sm-7
                #datetimepicker1.input-group.date.width-40
                  %input.form-control#meal_start{:type => "text", name: "meal[start]", value: @meal.bootrap_datetime_format }
                  %span.input-group-addon
                    %i.fa.fa-calendar
            .form-group
              = f.label :guests, class: "control-label col-sm-2"
              .col-sm-7
                = f.number_field :guests, class: "form-control input-mini"
            .form-group
              = f.label :ignore_warnings, class: "control-label col-sm-2", title: "Check to disable meal warnings such as 'not enough servings' or 'missing delivery time'", data: {toggle: "tooltip"}
              .col-sm-7
                = f.check_box :ignore_warnings, class: "form-control"
            .form-group
              .col-sm-3.col-sm-offset-2
                = f.submit "update", class: "btn btn-warning"
